@page "/staff/views"
@model App.Web.Areas.Staff.Pages.Views.Index
@using App.Web.Areas.Staff.Pages.Shared.Models

@{
    ViewData["Title"] = "Manage Views";
    ViewData["ActiveMenu"] = "Views";
}

<div class="staff-page-heading mb-4">
    <h1 class="h3 mb-0">Manage Views</h1>
    <a asp-area="Staff" asp-page="@RouteNames.Views.Create" class="btn btn-primary">
        <i class="bi bi-plus-lg me-2"></i>Create View
    </a>
</div>

<!-- My Custom Views -->
<div class="staff-card mb-4">
    <div class="staff-card-header">
        <h5><i class="bi bi-person me-2"></i>My Views</h5>
    </div>
    @if (!Model.MyViews.Any())
    {
        <div class="staff-card-body text-center py-5 text-muted">
            <i class="bi bi-layout-text-window" style="font-size: 3rem; opacity: 0.5;"></i>
            <p class="mt-3 mb-2 fw-medium">You haven't created any custom views yet.</p>
            <a asp-area="Staff" asp-page="@RouteNames.Views.Create" class="btn btn-primary btn-sm mt-2">
                <i class="bi bi-plus me-1"></i>Create your first view
            </a>
        </div>
    }
    else
    {
        <div class="table-responsive">
            <table class="table staff-table mb-0">
                <thead>
                    <tr>
                        <th style="width: 40px;"></th>
                        <th>Name</th>
                        <th>Filters</th>
                        <th>Columns</th>
                        <th>Created</th>
                        <th class="text-end">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.MyViews)
                    {
                        <tr>
                            <td class="text-center">
                                <form method="post" asp-page-handler="ToggleFavorite" asp-route-viewId="@item.View.Id" class="d-inline">
                                    <button type="submit" class="btn btn-link p-0 border-0" 
                                        title="@(item.IsFavorited ? "Remove from favorites" : "Add to favorites")"
                                        style="color: @(item.IsFavorited ? "#ffc107" : "#6c757d"); font-size: 1.1rem;">
                                        <i class="bi @(item.IsFavorited ? "bi-star-fill" : "bi-star")"></i>
                                    </button>
                                </form>
                            </td>
                            <td>
                                <a asp-area="Staff" asp-page="@RouteNames.Tickets.Index" asp-route-viewId="@item.View.Id"
                                    class="fw-semibold text-decoration-none" style="color: var(--staff-primary);">
                                    @item.View.Name
                                </a>
                            </td>
                            <td>
                                <span class="staff-badge staff-badge-secondary">@item.View.FilterCount filters</span>
                            </td>
                            <td>
                                <span class="staff-badge staff-badge-secondary">@item.View.ColumnCount columns</span>
                            </td>
                            <td class="text-muted small">@item.View.CreationTime.ToString("MMM dd, yyyy")</td>
                            <td class="text-end">
                                <a asp-area="Staff" asp-page="@RouteNames.Views.Edit" asp-route-id="@item.View.Id"
                                    class="text-muted me-3" title="Edit view" style="font-size: 1.1rem;">
                                    <i class="bi bi-pencil"></i>
                                </a>
                                <form method="post" asp-page-handler="Delete" asp-route-viewId="@item.View.Id" class="d-inline">
                                    <button type="submit" class="btn btn-link p-0 border-0 text-danger"
                                        onclick="return confirm('Delete this view?')" title="Delete view" style="font-size: 1.1rem;">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </form>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</div>

<!-- System Views -->
<div class="staff-card">
    <div class="staff-card-header">
        <h5><i class="bi bi-gear me-2"></i>System Views</h5>
    </div>
    @if (!Model.SystemViews.Any())
    {
        <div class="staff-card-body text-center py-4 text-muted">
            No system views available.
        </div>
    }
    else
    {
        <div class="table-responsive">
            <table class="table staff-table mb-0">
                <thead>
                    <tr>
                        <th style="width: 40px;"></th>
                        <th>Name</th>
                        <th>Description</th>
                        <th class="text-end">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.SystemViews)
                    {
                        <tr>
                            <td class="text-center">
                                <form method="post" asp-page-handler="ToggleFavorite" asp-route-viewId="@item.View.Id" class="d-inline">
                                    <button type="submit" class="btn btn-link p-0 border-0" 
                                        title="@(item.IsFavorited ? "Remove from favorites" : "Add to favorites")"
                                        style="color: @(item.IsFavorited ? "#ffc107" : "#6c757d"); font-size: 1.1rem;">
                                        <i class="bi @(item.IsFavorited ? "bi-star-fill" : "bi-star")"></i>
                                    </button>
                                </form>
                            </td>
                            <td>
                                <a asp-area="Staff" asp-page="@RouteNames.Tickets.Index" asp-route-viewId="@item.View.Id"
                                    class="fw-semibold text-decoration-none" style="color: var(--staff-primary);">
                                    <i class="bi bi-lock me-1 small text-muted"></i>@item.View.Name
                                </a>
                            </td>
                            <td class="text-muted">@item.View.Description</td>
                            <td class="text-end">
                                <a asp-area="Staff" asp-page="@RouteNames.Tickets.Index" asp-route-viewId="@item.View.Id"
                                    class="btn btn-sm btn-outline-primary">
                                    Use View
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</div>
