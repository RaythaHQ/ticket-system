@page "/staff/dashboard"
@model App.Web.Areas.Staff.Pages.Dashboard.Index

@{
    ViewData["Title"] = "Dashboard";
    ViewData["ActiveMenu"] = "Dashboard";
}

<partial name="_Partials/PageHeading" model='"Welcome back!"' />

<!-- Key Metrics -->
<div class="row g-4 mb-4">
    <div class="col-lg-3 col-md-6">
        <div class="staff-stat-card primary">
            <div class="d-flex justify-content-between align-items-start mb-3">
                <div class="staff-stat-icon primary">
                    <i class="bi bi-ticket-detailed"></i>
                </div>
            </div>
            <div class="staff-stat-value">@Model.Metrics.OpenTicketsAssigned</div>
            <div class="staff-stat-label">Open Tickets</div>
        </div>
    </div>
    <div class="col-lg-3 col-md-6">
        <div class="staff-stat-card success">
            <div class="d-flex justify-content-between align-items-start mb-3">
                <div class="staff-stat-icon success">
                    <i class="bi bi-check-circle"></i>
                </div>
            </div>
            <div class="staff-stat-value">@Model.Metrics.TicketsResolvedLast7Days</div>
            <div class="staff-stat-label">Resolved (7 days)</div>
        </div>
    </div>
    <div class="col-lg-3 col-md-6">
        <div class="staff-stat-card warning">
            <div class="d-flex justify-content-between align-items-start mb-3">
                <div class="staff-stat-icon warning">
                    <i class="bi bi-calendar-check"></i>
                </div>
            </div>
            <div class="staff-stat-value">@Model.Metrics.TicketsResolvedLast30Days</div>
            <div class="staff-stat-label">Resolved (30 days)</div>
        </div>
    </div>
    <div class="col-lg-3 col-md-6">
        <div class="staff-stat-card secondary">
            <div class="d-flex justify-content-between align-items-start mb-3">
                <div class="staff-stat-icon secondary">
                    <i class="bi bi-clock-history"></i>
                </div>
            </div>
            <div class="staff-stat-value">
                @if (Model.Metrics.MedianCloseTimeHours.HasValue)
                {
                    @($"{Model.Metrics.MedianCloseTimeHours.Value:F1}h")
                }
                else
                {
                    <span>â€”</span>
                }
            </div>
            <div class="staff-stat-label">Median Close Time</div>
        </div>
    </div>
</div>

<!-- SLA & Quality Metrics -->
<div class="row g-4 mb-4">
    <div class="col-lg-6">
        <div class="staff-card">
            <div class="staff-card-header">
                <h5><i class="bi bi-hourglass-split me-2"></i>SLA Status</h5>
            </div>
            <div class="staff-card-body">
                <div class="row text-center">
                    <div class="col-6">
                        <div class="p-3">
                            <h3 class="mb-1 @(Model.Metrics.SlaBreachCount > 0 ? "text-danger" : "text-success")"
                                style="font-size: 2.5rem; font-weight: 700;">
                                @Model.Metrics.SlaBreachCount
                            </h3>
                            <p class="text-muted mb-0 small fw-medium">Breached</p>
                        </div>
                    </div>
                    <div class="col-6 border-start">
                        <div class="p-3">
                            <h3 class="mb-1 @(Model.Metrics.SlaApproachingCount > 0 ? "text-warning" : "text-success")"
                                style="font-size: 2.5rem; font-weight: 700;">
                                @Model.Metrics.SlaApproachingCount
                            </h3>
                            <p class="text-muted mb-0 small fw-medium">Approaching Breach</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-6">
        <div class="staff-card">
            <div class="staff-card-header">
                <h5><i class="bi bi-graph-up me-2"></i>Quality Metrics</h5>
            </div>
            <div class="staff-card-body">
                <div class="row text-center">
                    <div class="col-6">
                        <div class="p-3">
                            <h3 class="mb-1" style="font-size: 2.5rem; font-weight: 700;">@Model.Metrics.ReopenCount
                            </h3>
                            <p class="text-muted mb-0 small fw-medium">Reopened Tickets</p>
                        </div>
                    </div>
                    <div class="col-6 border-start">
                        <div class="p-3">
                            <h3 class="mb-1" style="font-size: 2.5rem; font-weight: 700;">
                                @($"{Model.Metrics.ReopenRate:F1}%")</h3>
                            <p class="text-muted mb-0 small fw-medium">Reopen Rate</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Team Summaries -->
@if (Model.Metrics.TeamSummaries.Any())
{
    <div class="staff-card mb-4">
        <div class="staff-card-header">
            <h5><i class="bi bi-people me-2"></i>My Teams</h5>
        </div>
        <div class="table-responsive">
            <table class="table staff-table mb-0">
                <thead>
                    <tr>
                        <th>Team</th>
                        <th class="text-center">Open Tickets</th>
                        <th class="text-center">Unassigned</th>
                        <th class="text-end">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var team in Model.Metrics.TeamSummaries)
                    {
                        <tr>
                            <td>
                                <span class="fw-semibold">@team.TeamName</span>
                            </td>
                            <td class="text-center">
                                <span class="staff-badge staff-badge-primary">@team.OpenTickets</span>
                            </td>
                            <td class="text-center">
                                <span
                                    class="staff-badge @(team.UnassignedTickets > 0 ? "staff-badge-warning" : "staff-badge-secondary")">
                                    @team.UnassignedTickets
                                </span>
                            </td>
                            <td class="text-end">
                                <a asp-page="@RouteNames.Tickets.Index" asp-route-teamId="@team.TeamId"
                                    class="btn btn-sm btn-outline-primary">
                                    View Tickets
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
}

<!-- Quick Actions -->
<div class="staff-card">
    <div class="staff-card-header">
        <h5><i class="bi bi-lightning me-2"></i>Quick Actions</h5>
    </div>
    <div class="staff-card-body">
        <div class="row g-3">
            <div class="col-lg-3 col-md-6">
                <a asp-page="@RouteNames.Tickets.Create" class="btn btn-primary w-100 py-3">
                    <i class="bi bi-plus-circle me-2"></i>Create Ticket
                </a>
            </div>
            <div class="col-lg-3 col-md-6">
                <a asp-page="@RouteNames.Tickets.Index" asp-route-assigneeId="@Model.UserId"
                    class="btn btn-outline-primary w-100 py-3">
                    <i class="bi bi-person me-2"></i>My Tickets
                </a>
            </div>
            <div class="col-lg-3 col-md-6">
                <a asp-page="@RouteNames.Contacts.Index" class="btn btn-outline-secondary w-100 py-3">
                    <i class="bi bi-people me-2"></i>Contacts
                </a>
            </div>
            <div class="col-lg-3 col-md-6">
                <a asp-page="@RouteNames.Tickets.Index" class="btn btn-outline-secondary w-100 py-3">
                    <i class="bi bi-list-task me-2"></i>All Tickets
                </a>
            </div>
        </div>
    </div>
</div>
