@model IEnumerable<App.Application.Tickets.TicketListItemDto>
@using App.Domain.ValueObjects

<div class="table-responsive">
    <table class="table table-hover mb-0">
        <thead class="table-light">
            <tr>
                <th>ID</th>
                <th>Title</th>
                <th>Status</th>
                <th>Priority</th>
                <th>Created</th>
            </tr>
        </thead>
        <tbody>
            @if (!Model.Any())
            {
                <tr>
                    <td colspan="5" class="text-center py-4 text-muted">
                        No tickets for this contact.
                    </td>
                </tr>
            }
            @foreach (var ticket in Model)
            {
                <tr>
                    <td>
                        <a asp-area="Staff" asp-page="@RouteNames.Tickets.Details" asp-route-id="@ticket.Id">
                            #@ticket.Id
                        </a>
                    </td>
                    <td>
                        <a asp-area="Staff" asp-page="@RouteNames.Tickets.Details" asp-route-id="@ticket.Id">
                            @(ticket.Title.Length > 40 ? ticket.Title.Substring(0, 37) + "..." : ticket.Title)
                        </a>
                    </td>
                    <td><span class="badge @GetStatusBadgeClass(ticket.Status)">@ticket.StatusLabel</span></td>
                    <td><span class="badge @GetPriorityBadgeClass(ticket.Priority)">@ticket.PriorityLabel</span></td>
                    <td>@ticket.CreationTime.ToString("MMM dd, yyyy")</td>
                </tr>
            }
        </tbody>
    </table>
</div>

@functions {
    string GetStatusBadgeClass(string status)
    {
        try
        {
            var statusObj = TicketStatus.From(status);
            return statusObj.DeveloperName switch
            {
                TicketStatus.OPEN => "bg-primary",
                TicketStatus.IN_PROGRESS => "bg-info",
                TicketStatus.PENDING => "bg-warning text-dark",
                TicketStatus.RESOLVED => "bg-success",
                TicketStatus.CLOSED => "bg-secondary",
                _ => "bg-light text-dark"
            };
        }
        catch
        {
            return "bg-light text-dark";
        }
    }

    string GetPriorityBadgeClass(string priority)
    {
        try
        {
            var priorityObj = TicketPriority.From(priority);
            return priorityObj.DeveloperName switch
            {
                TicketPriority.URGENT => "bg-danger",
                TicketPriority.HIGH => "bg-warning text-dark",
                TicketPriority.NORMAL => "bg-info",
                TicketPriority.LOW => "bg-light text-dark",
                _ => "bg-light text-dark"
            };
        }
        catch
        {
            return "bg-light text-dark";
        }
    }
}
